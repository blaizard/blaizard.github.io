
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Channels - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#channels" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Channels
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/blaizard/bzd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bzd
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/blaizard/bzd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bzd
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          BDL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="BDL" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          BDL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bdl/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bdl/syntax.html" class="md-nav__link">
        Syntax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bdl/components.html" class="md-nav__link">
        Components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bdl/composition.html" class="md-nav__link">
        Composition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bdl/executors.html" class="md-nav__link">
        Executors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bdl/gateway.html" class="md-nav__link">
        Gateway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bdl/system.html" class="md-nav__link">
        System
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Bazel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bazel" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Bazel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/bazel/bdl.html" class="md-nav__link">
        bdl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/bazel/cc.html" class="md-nav__link">
        cc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/bazel/docker.html" class="md-nav__link">
        docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/bazel/nodejs.html" class="md-nav__link">
        nodejs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/bazel/nodejs_web.html" class="md-nav__link">
        nodejs_web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/bazel/package.html" class="md-nav__link">
        package
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          C++
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="C++" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          C++
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cc/index.html" class="md-nav__link">
        Layout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cc/bzd/core/async/README.md" class="md-nav__link">
        Async
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#declaration" class="md-nav__link">
    Declaration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapter" class="md-nav__link">
    Adapter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transport" class="md-nav__link">
    Transport
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#channel-interface" class="md-nav__link">
    Channel Interface
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="channels">Channels</h1>
<p>Channels are ways to communicate to the external world.
It can be used as a communication mean through local buses (I2C, UART...), shared memory or more widely via internet.</p>
<p>A channel consists of 2 layers, the adapter and the transport layer.
The adapter layer has the role to serialize/deserialize the data as well as consistency/errors checks at the data level.
The tranport layer has the role to transport data blobs via a bus, in addition to a blob, on specific buses it needs inputs
such as destination address, etc.</p>
<p>When configuring a channel, the transport can only be configured once (durign initialization), while the adapter
is responsible to "adapt" the Data payload to the transport. The adapter is initialized with arguments
that can be used with the transport interface, for the example a chip select, or I2C device address.</p>
<p>A channel (adapter + transport), exposes a common interface through a Data payload (adapter) and a common way to
monitor and control the transport component (transport).
Note, at compile time a channel is fully defined, makind this composition between the 2 layers a constant expression
exposing a Channel<Data> interface.</p>
<p>Some buses might have a Channel interface as well, buses like UART for example, which do not need adapters in betweeen and
can be used directly as is.
Also a channel can be made on top of another channel, by making one part of the transport interface, this allow nestiing channels
for complex schemes.</p>
<h2 id="declaration">Declaration</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>composition {
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    // Register an I2C bus driver. This has an unique instance withinI2CTransport the application.
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    // This is to ensure unique access if needed and avoid code duplication.
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    // A communication driver must have a transport interface.
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    i2c = I2C(role = &quot;master&quot;, speed = 1000000);
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>}
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>interface I2CTransport
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>{
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    read(...)
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    write(...);
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>};
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>using I2CDevice = Adapter&lt;Buffer, I2CTransport&gt;;
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>composition {
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    tempSensor = I2CDevice(address = 12, addressing = 10/*bit*/, transport = &amp;i2c); 
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>}
</code></pre></div>
<p>The representation of the Channel class in C++ would look like this:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">using</span><span class="w"> </span><span class="n">I2CDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">I2CTransport</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">I2CDevice</span><span class="o">&lt;</span><span class="mi">10</span><span class="cm">/*receive*/</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="cm">/*send*/</span><span class="o">&gt;</span><span class="w"> </span><span class="n">i2CTempSensor</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="cm">/*bit*/</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i2c</span><span class="p">);</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">Data</span><span class="o">&gt;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">I2CTempSensor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">I2CTransport</span><span class="o">&gt;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="p">{</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="n">I2CTempSensor</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">addressing</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">            </span><span class="o">:</span><span class="w"> </span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">I2CTransport</span><span class="o">&gt;</span><span class="p">{</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">addressing</span><span class="p">}</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="n">buffer</span><span class="o">&lt;</span><span class="n">RecvBufferSize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">receive_</span><span class="p">;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="n">buffer</span><span class="o">&lt;</span><span class="n">SendBufferSize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">send_</span><span class="p">;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="p">};</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">Data</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Transport</span><span class="o">&gt;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">Adapter</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Channel</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="p">{</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="n">Adapter</span><span class="p">(</span><span class="n">Transport</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transport</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">transport_</span><span class="p">{</span><span class="n">transport</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">    </span><span class="n">Result</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">Data</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">        </span><span class="n">transport_</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span><span class="n">Transport</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transport_</span><span class="p">;</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="p">};</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="c1">// Specialization for I2C</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="p">...</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span><span class="n">Adapter</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">Transport</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transport</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">address_</span><span class="p">{</span><span class="n">address</span><span class="p">},</span><span class="w"> </span><span class="n">mode_</span><span class="p">{</span><span class="n">mode</span><span class="p">},</span><span class="w"> </span><span class="n">transport_</span><span class="p">{</span><span class="n">transport</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">    </span><span class="n">Result</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">Data</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">        </span><span class="n">transport_</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="p">...</span>
</code></pre></div></p>
<h2 id="adapter">Adapter</h2>
<p>The adapter implementation would be defined as follow:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>interface I2CDevice {
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    struct Data {
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        integer data;
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    }
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    method serialize(Data) -&gt; Result&lt;Sequence&lt;Byte&gt;&gt;;
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    method deserialize(Sequence&lt;Byte&gt;) -&gt; Result&lt;Data&gt;;
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>}
</code></pre></div>
<p>or a more complex adpater could be defined as follow:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>interface I2CDevice {
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    struct Data {
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        integer destinationId;
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        Sequence&lt;Byte, 4&gt; payload;
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        integer crc [min = 0, max = 255];
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        timestamp time;
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    }
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    method serialize(Data) -&gt; Result&lt;Sequence&lt;Byte&gt;&gt;;
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    method deserialize(Sequence&lt;Byte&gt;) -&gt; Result&lt;Data&gt;;
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>}
</code></pre></div>
<p>By default serialize and deserialize templated functions will be autogenerated,
however the user can specialize their implementation if needed.
Here is an example of could look such function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// Auto-generate serialization function</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">Result</span><span class="o">&lt;</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">serialize</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">{</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bzd</span><span class="o">::</span><span class="n">Serialize</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">}</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1">// Specialized function adds a byte in from of the payload</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="n">Result</span><span class="o">&lt;</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">serialize</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="p">{</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;</span><span class="p">{</span><span class="mh">0x2a</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">};</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="p">}</span>
</code></pre></div>
<h2 id="transport">Transport</h2>
<p>The transport implementation should have an interface as follow, the service related information
should remain the same, while the read/write method can have a specialized interface.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>interface Transport {
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    // Service related
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    method start() -&gt; Result&lt;void&gt;;
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    method stop() -&gt; Result&lt;void&gt;;
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    method getStatus() -&gt; Status;
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    // Statistics
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    sent = UInt32;
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    received = UInt32;
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    // Data
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    onRead() -&gt; // Optional
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    method read() -&gt; Result&lt;Sequence&lt;Byte&gt;&gt;;
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    method write(Sequence&lt;Byte&gt;) -&gt; Result&lt;void&gt;;
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>}
</code></pre></div>
<h2 id="channel-interface">Channel Interface</h2>
<p>The user will only have access to the channel via its interface, which abstract all the transportation details underneath.
This interface is auto generated from the channel object.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>interface Channel {
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    struct Data {
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>        integer temperature;
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>        timestamp time;
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    }
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    read() -&gt;
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>}
</code></pre></div>
<h1 id="buffers">Buffers</h1>
<p>An optional message queue should be available in the transport layer for bus-wide messages, but also in the adapter layer for messages
that should be kept per instance, for example, for a specific SPI channel or a specific CAN message.</p>
<h2 id="use-cases">Use Cases</h2>
<h3 id="i2c-device-address-or-chip-select-interface">I2C device address or chip select interface</h3>
<p>Some protocol need to set a signal or append some id to the payload in order to select the destination device. This is done in the adapter layer.</p>
<h3 id="transport-with-exclusive-access">Transport with exclusive access</h3>
<p>Some transport layer might have access limited to a single transaction at a time.
This can be handled in the transport layer, with a mutex mechanism to prevent mutual access.</p>
<h1 id="interrupt-driven-drivers">Interrupt driven drivers</h1>
<p>interrupt driven driver will write their payload into a receive queue, this can be handled
in the transport layer.
However, the adaptor might also want to keep some messages in a queue as well, for example
for some critical messages that should not be missed.</p>
<h1 id="runtime-discoverable-adapter-config">Runtime discoverable adapter config</h1>
<p>Some devices might require for example a discovery stage before assigning their addresses
from the adaptor.
!!! not supported yet</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>